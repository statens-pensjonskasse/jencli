@Library('jenkins-pipeline-library')
import no.spk.jenkins.pipeline.ci.config.CIPipelineConfig

String BUILD_IMAGE='cr.spk.no/infra/jenkins-agent-docker'

ciPipeline {
    config = CIPipelineConfig
            .getTrunkBasedConfig(trunk: 'main')
            .useMake(
                buildImage: BUILD_IMAGE,
                build: 'build-ci',
                test: 'test-ci',
                buildContainerArgs: '-e DOCKER_HOST=${DOCKER_HOST}')
            .withSonarQube()
            .withSlackNotifications(channels: 'applikasjonsplattform-ci')
            .withLog(level: 'all')
}